# Deposit Products Plugin

Мультиязычный плагин для управления депозитными продуктами в WordPress с интеграцией Polylang.

## Возможности

- Создание и управление депозитными продуктами через админку WordPress
- Полная поддержка мультиязычности через Polylang
- Красивое отображение карточек депозитов на фронтенде
- Детальная страница каждого депозита с баннером
- Responsive дизайн (адаптивная верстка)
- Легкая интеграция через шорткод

## Установка

1. Скопируйте папку `deposit-products` в `wp-content/plugins/`
2. Активируйте плагин в админке WordPress
3. Перейдите в "Депозиты" для добавления продуктов

## Использование

### Добавление депозита в админке

1. Перейдите в **Депозиты → Добавить новый**
2. Заполните:
   - **Название** - название депозита (например: "Вклад Максад")
   - **Изображение записи** - логотип депозита
   - **Процент в сомони** - процентная ставка в сомони
   - **Процент в долларах** - процентная ставка в долларах
   - **Срок** - срок депозита (например: "1 год", "6 месяцев")
   - **Минимальная сумма** - минимальная сумма депозита
   - **Валюта минимальной суммы** - сомони или доллары
   - **URL формы заявки** - ссылка на форму заявки (по умолчанию `#deposit-form`)
   - **Контент** - подробное описание депозита (отображается на детальной странице)

3. Опубликуйте депозит

### Мультиязычность (Polylang)

Плагин полностью интегрирован с Polylang и поддерживает автоматическую синхронизацию данных.

#### Создание переводов депозитов:

1. Создайте депозит на основном языке (например, русском)
2. Заполните все параметры: название, изображение, проценты, срок и т.д.
3. В правом сайдбаре найдите блок "Языки" (Languages)
4. Нажмите на иконку "+" рядом с нужным языком (английский или таджикский)
5. **ВАЖНО**: Все параметры депозита (проценты, срок, минимальная сумма) и изображение автоматически скопируются!
6. Вам нужно перевести только название и описание (контент)
7. Опубликуйте перевод

#### Автоматическая синхронизация:

При изменении параметров депозита на одном языке, изменения автоматически применяются ко всем переводам:

✅ **Синхронизируются автоматически:**
- Процент в сомони
- Процент в долларах
- Срок депозита
- Минимальная сумма
- Валюта
- URL формы заявки
- Изображение (миниатюра)

❌ **НЕ синхронизируются (переводятся вручную):**
- Название депозита
- Описание (контент)

#### Отображение по языкам:

Шорткод `[deposit_products]` автоматически показывает только депозиты текущего языка. Переключение языка происходит автоматически при использовании языкового переключателя Polylang

### Отображение на фронтенде

Используйте шорткод на любой странице или в записи:

```
[deposit_products]
```

Параметры шорткода:
- `limit` - количество депозитов для отображения (по умолчанию: все)

Пример:
```
[deposit_products limit="3"]
```

### Карточка депозита

Каждая карточка отображает:
- Логотип (изображение записи)
- Название депозита
- Процент в сомони
- Процент в долларах
- Срок
- Минимальная сумма
- 2 кнопки:
  - **Амонат гузоштан** - открывает форму заявки
  - **Бештар** - переход на детальную страницу

### Детальная страница

На детальной странице депозита отображается:
- Баннер с основной информацией
- Кнопка "Амонат гузоштан"
- Подробное описание из контента

## Переводы

Плагин поддерживает 3 языка:
- Русский (ru)
- Английский (en)
- Таджикский (tj)

Все тексты автоматически переводятся согласно текущему языку сайта.

### Основные термины (таджикский):

- **Даромад бо сом.** - Доход в сомони
- **Даромад бо долл.** - Доход в долларах
- **Муҳлат** - Срок
- **Маблағ** - Сумма
- **то** - до
- **аз** - от
- **Амонат гузоштан** - Открыть депозит
- **Бештар** - Подробнее

## Кастомизация стилей

Стили находятся в файле `assets/css/deposit-products.css`

Основные CSS классы:
- `.deposit-products-grid` - сетка карточек
- `.deposit-card` - карточка депозита
- `.deposit-banner` - баннер на детальной странице
- `.deposit-btn-primary` - основная кнопка
- `.deposit-btn-secondary` - вторичная кнопка

## Структура плагина

```
deposit-products/
├── deposit-products.php      # Основной файл плагина
├── assets/
│   └── css/
│       └── deposit-products.css  # Стили
├── templates/
│   └── single-deposit.php    # Шаблон детальной страницы
└── README.md                 # Документация
```

## Требования

- WordPress 5.0+
- PHP 7.4+
- Polylang 3.0+ (для мультиязычности)

## Устранение неполадок

### Проблема: На английской версии показываются только названия без картинок

**Решение:**
1. Убедитесь, что вы создали перевод через Polylang (кнопка "+" в блоке "Языки"), а не новый депозит
2. Проверьте, что плагин обновлен до последней версии
3. Пересохраните депозит на основном языке (это запустит синхронизацию)

### Проблема: Неправильные ссылки при переключении языков

**Решение:**
1. Перейдите в "Настройки → Постоянные ссылки"
2. Нажмите "Сохранить изменения" (это обновит структуру URL)
3. Очистите кеш сайта, если используется плагин кеширования

### Проблема: Ссылка "Все депозиты" ведет на #

**Решение:** Настройте ID страницы депозитов одним из способов:

**Способ 1:** Добавьте в `functions.php` вашей темы:
```php
update_option('page_for_deposits', 123); // замените 123 на ID вашей страницы депозитов
```

**Способ 2:** Создайте страницу с правильным slug:
- Для русского: `deposits`
- Для английского: `deposits`
- Для таджикского: `amonatho`

### Проблема: Параметры депозита не синхронизируются

**Решение:**
1. Убедитесь, что Polylang активирован
2. Пересохраните депозит на основном языке
3. Проверьте, что в админке видны связи между переводами (блок "Языки")

## История изменений

### Версия 1.0.1 (22.12.2025)
- ✅ Исправлена интеграция с Polylang
- ✅ Добавлена автоматическая синхронизация мета-полей между переводами
- ✅ Добавлена автоматическая синхронизация миниатюр
- ✅ Исправлена фильтрация депозитов по текущему языку в шорткоде
- ✅ Улучшена логика получения ссылки на страницу "Все депозиты"
- ✅ Обновлены файлы переводов с русским языком в качестве ключей (msgid)

### Версия 1.0.0 (16.12.2025)
- ✅ Первый релиз плагина
- ✅ Базовая поддержка Polylang

## Поддержка

Если возникли вопросы или проблемы, обратитесь к разработчику.
